# Техническая Архитектура: Гибридная Система (RCON + Mod)

В данном документе описано архитектурное решение использования гибридного подхода (RCON + Серверный Мод) для мониторинга сервера DayZ.

## 1. Проблема: Однопоточность DayZ
Движок **Enforce Script**, на котором работают моды, исполняется в **основном потоке (Main Thread)** симуляции сервера.
*   **Следствие:** Любая тяжелая операция в скрипте (циклы, сериализация JSON, работа со строками) блокирует просчет физики, ИИ и сетевой синхронизации.
*   **Риск:** Сбор данных о 60+ игроках исключительно силами мода вызывает микро-фризы (stuttering) и падение Server FPS.

## 2. Сравнение подходов

| Характеристика | RCON (Remote Console) | Серверный Мод (RestApi) |
| :--- | :--- | :--- |
| **Поток исполнения** | Отдельный сетевой поток (Network Thread) | Основной поток симуляции (Main Thread) |
| **Влияние на FPS** | Минимальное / Нулевое | Высокое (при плохой оптимизации) |
| **Garbage Collection** | Нет (обрабатывается внешним приложением) | Высокая нагрузка (String Allocations при сборке JSON) |
| **Доступность при лагах** | Высокая (отвечает даже при 0 FPS) | Низкая (виснет вместе с сервером) |
| **Детализация данных** | Базовая (Имя, IP, GUID, Ping) | Полная (Позиция, HP, Игровое время) |

## 3. Реализация в RSTRT

Мы используем **Гибридный подход** для баланса между производительностью и детализацией.

### A. Слой RCON (Node.js / Electron)
*   **Роль:** Основной источник правды и управления.
*   **Частота:** Высокая (каждые 3-5 сек).
*   **Данные:** Список игроков, GUID, IP, Пинг, Кик/Бан, Чат.
*   **Преимущество:** Запросы обрабатываются движком асинхронно, не останавливая симуляцию мира.

### B. Слой Мода (Telemetry / RestApi)
*   **Роль:** Обогащение данных (Enrichment).
*   **Частота:** Средняя (каждые 5-10 сек).
*   **Данные:** Точные координаты (XYZ), Здоровье, Игровое время, Server FPS.
*   **Оптимизация:**
    *   Использование `string.Format` вместо конкатенации для снижения аллокаций памяти.
    *   Отправка только "легких" типов данных.
    *   Отсутствие дублирования списка игроков (если RCON активен).

## 4. Механизм Detection & Recovery
Гибридная система позволяет диагностировать состояние **Deadlock** (Зависание процесса):
1.  **RCON отвечает**, но **Мод молчит** > 30 секунд.
2.  **Диагноз:** Процесс запущен, порт открыт, но игровой цикл (Simulation Loop) остановлен или завис.
3.  **Действие:** Автоматический перезапуск сервера (Watchdog).

*Чисто модовое решение не может отличить "Зависание" от "Падения сети", так как перестает отвечать в обоих случаях.*
