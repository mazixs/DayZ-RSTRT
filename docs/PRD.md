# Требования к продукту (PRD): DayZ Server Manager (DayZ-RSTRT)

## 1. Обзор
Кроссплатформенное десктопное приложение (Windows/Linux) для управления серверами DayZ. Предоставляет мониторинг в реальном времени, управление через RCON, аналитику и автоматические проверки здоровья (обнаружение зависаний/крашей) через кастомный серверный мод.

## 2. Ключевые функции

### 2.1 Мониторинг Сервера (Реализовано)
- **Статус в реальном времени:** Онлайн/Оффлайн (через RCON).
- **Детальная телеметрия (Мод):**
  - **FPS Сервера:** Точный внутренний FPS движка.
  - **Данные Игроков:** Здоровье, Позиция, SteamID64.
- **Слияние данных:** Умное объединение данных RCON (IP, Пинг) с данными Мода (Здоровье, Позиция, GUID).
  - **Механизм:** Мод отправляет `SteamID64`. Приложение вычисляет `BattlEye GUID` (MD5) для сопоставления с записями RCON.

### 2.2 Управление RCON (Реализовано)
- **Подробная документация:** [RCON.md](./RCON.md)
- **Подключение:** Поддержка стандартного протокола Source RCON.
- **Авто-переподключение:** Надежная обработка разрывов с автоматическим повтором.
- **Статус:** Визуальный индикатор подключения в боковой панели.

### 2.3 Автоматизация и Здоровье (Реализовано)
- **Обнаружение зависаний (Freeze Detection):**
  - **Логика:** Мониторинг "сердцебиения" от RCON и Телеметрии Мода.
  - **Условие:** Если RCON онлайн (процесс жив), НО телеметрия от мода не приходит > 15 сек — сервер помечается как **Зависший**.
  - **Действие:** Критическое предупреждение в дашборде и системное уведомление Windows.
- **Обнаружение крашей:** Детекция потери соединения RCON и падения процесса.

### 2.4 Аналитика и Статистика (В разработке)
- **Подробная документация:** [ANALYTICS.md](./ANALYTICS.md)
- **Цель:** Долгосрочный анализ производительности и аудитории.
- **Ключевые метрики:**
  - **Производительность:** История FPS, использование ресурсов.
  - **Популяция:** Графики онлайна (CCU), новые игроки, уникальные посетители (DAU).
  - **Игроки:** Рейтинги по времени игры, история сессий.

### 2.5 Планировщик и Менеджер Процессов (Реализовано)
- **Подробная документация:** [SCHEDULER.md](./SCHEDULER.md)
- **Автоматические Рестарты:**
  - Настраиваемый интервал (например, каждые 4 часа).
  - Гибкая система задач (BEC-style): Выполнение любых команд за X минут до рестарта.
- **Управление Жизненным Циклом Процесса:**
  - **Авто-Рестарт:** Автоматический перезапуск `.exe` после выключения.
  - **Watchdog:** Принудительное завершение зависшего процесса.

### 2.6 Интерфейс Управления (Реализовано)
- **Dashboard:**
  - Минималистичный дизайн.
  - Ключевые метрики: Статус, Игроки (число), FPS, Таймер, Время в игре.
- **Players:**
  - Отдельная страница управления игроками.
  - Таблица с поиском, сортировкой и детальными данными (Ping, GUID, IP, Pos, Health).
- **Process Manager:**
  - Управление запуском сервера.
- **Settings:**
  - Настройка RCON.
  - Настройка задач Планировщика.

## 3. Архитектура

### 3.1 Гибридная "Push" Архитектура
- **Направление:** **Push** (Сервер -> Приложение) вместо Pull.
- **Механизм:**
  - **RCON (Pull):** Приложение опрашивает RCON каждые 2-5 сек (базовый статус/IP).
  - **Мод (Push):** Enforce Script отправляет JSON телеметрию каждые 5 сек на HTTP сервер приложения.
- **Преимущества:** Обход проблем с фаерволом для входящих соединений к игровому серверу; чистый поток данных.

### 3.2 Поток Данных
1.  **Мод:** Отправляет `SteamID64` + Health + Pos.
2.  **Приложение (Бэкенд):** Вычисляет `BattlEye GUID` (MD5 от SteamID64).
3.  **Приложение (Store):** Объединяет данные Мода с данными RCON (IP, Ping) используя `GUID` как ключ.

## 4. Технический Стек
- **Runtime:** Electron (Main + Renderer).
- **Frontend:** React, TypeScript, Vite, Ant Design.
- **Backend (Внутренний):** 
  - Express.js (Сервер Телеметрии).
  - `better-sqlite3` (Локальная база данных для аналитики).
  - `battle-node-v2` (Клиент BattlEye RCON).
- **Мод:** Enforce Script (C-style).

## 5. Безопасность и Конфигурация
- **Конфиг:** `$profile:DayZ-RSTRT/config.json` на стороне сервера позволяет менять IP/Порт без перекомпиляции мода.
- **Валидация:** Приложение проверяет структуру входящего JSON.
